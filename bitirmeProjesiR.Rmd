---
title: Kariyer.net sitesi üzerinden çekilen 'istatistik' anahtar kelimeli ilanların
  analiz edilmesi
author: "Fatih Ekici"
output:
  html_document:
    df_print: paged
---

```{r include=FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE
)
```

```{css, echo=FALSE}

#invisible {
   color: blue;
 font-size: 1.2em;
  display:none;
}



```


# Giriş

Kariyer.net üzerindeki ilanları python üzerinde selenium kütüphanesi ile çekildi. Daha sonrasında excel üzerinden el ile veri analitiği ile alakasız veya istatistik mezunlarının girme şansı olmayan/girmek istemeyeceği ilanları düşürüldü. Toplam veri sayısı 717 den 496 adet ilana düşürülmüştür. Bu işlemin yapılma sebebi +400 adet olan eşsiz pozisyon isimlerini daha kolay bir biçimde üst gruplara alabilmek ve daha tutarlı sonuçlar elde etmektir.

Buna ek olarak **pozisyon kısa** adı altında ilanlar belirli başlı niteliklere göre gruplandırılmıştır.

1.  veri analisti(iş zekası, veri analitiği, veri bilimci ,dijital reklamcılık sektör veya tittlelarına aitilanlar)

2.  finans analisti(finans sektörü hakkında bilgi gerektiren analist pozisyonları)

3.  develoaper(herhangi bir sektörde yazılım-it-bilgi işlem tarafındaki pozisyonlar

4.  iş analisti(finans analistine benzer şekilde genel anlamda yapılan iş ile alakalı analist pozisyonuna sahip pozisyonlar)

5.  insan kaynaklari (çoğunlukla ik işleri olmak üzere az sayıda personel ile ilgilenen pozisyonlar

6.  ticaret uzmanı(çoğunlukla evrak işleri, ithalat, ihracat ve satış pozisyonlarında uzmanlık gösteren pozisyonlar)

7.  Muhasebe

Bazı ilanlar pek çok pozisyona yakın davranmasından dolayı en yakın seçenek tercih edilmiştir.

# Tanımlayıcı bilgiler

```{r librarys}

library(readr)
library(readxl)
library(tm)
library(htmltools)
library("gridExtra")
library(tidyverse)
library(arsenal)
library("cowplot")
filter<-dplyr::filter
select<-dplyr::select
library(stringr)

```

```{r}
#verinin okutulması ve çakışan ilan durumu için unique ile temizlenmesi. 
mainDF <- read_excel("mainDF.xlsx")
mainDF<-unique(mainDF)
mainDF %>% filter(!grepl("QUALIFICATIONS AND JOB DESCRIPTION",metin))->mainDF
```






# Kaç farklı pozisyon vardır ve en çok tekrar edenler hangileridir?

Toplam `r length(unique(mainDF$pozisyon))` adet essiz isimli pozisyon bulunmaktadir.

```{r}
mainDF %>% 
  group_by(pozisyon) %>% 
  summarise(frekans=n()) %>%
  arrange(-frekans) %>% 
  slice(1:10) %>% 
  kableExtra::kable()

```

Görüldüğü gibi frekans sayıları benzer işlerin farklı sayılarla belirtilmesi sebebiyle azdır.Kısaltılmış ilanların frekans tablosu aşağıda verilmiştir.

```{r}
mainDF %>% 
  group_by(pozisyon_kisa) %>% 
  summarise(frekans=n()) %>% 
  arrange(-frekans) %>%
  rename(`indirgenmiş pozisyon`=pozisyon_kisa)%>%
  kableExtra::kable()
```

```{r}
mainDF %>%
  group_by(pozisyon_kisa) %>%
  summarise(frekans=n()) %>%
  arrange(-frekans) %>% 
  rename(`indirgenmiş pozisyon`=pozisyon_kisa) %>%
  ###plot asamasi
  ggplot(.,aes(x=reorder(`indirgenmiş pozisyon`, -frekans),y=frekans))+
  geom_bar(stat = "identity",col='white',fill='steelblue')+
  labs(x='pozisyonlar',
  title ='indirgenmiş ilanların frekansları tablosu')+
  theme_classic()


```

Beklenildiği üzere istatistik anahtar kelimeli ilanlarlarda analist pozisyonların ön sıralarda olduğunu, diğer meslek dallarında daha az ön planda olduğunu görmekteyiz. Finans sektörünün tek başına yüksek miktarda analist barındırdığı görülebilmektedir.

Bu kısım indirgemenin bir yan etkisi olarak net yorumlarda bulunmamızı engellemektedir. Bu sebeple sektör ve departmanları inceleyerek daha iyi bir öngörü elde edilmeye çalışılmıştır.

# Departman ve sektörel dağılım

Kariyer.net ilanlara ait sektör ve departman bilgilerini de sunmakta, bu sayede iş ilanlarının hangi sektör ve departmanda daha çok yoğunlaştığı aşağıda tablo ve grafiklerle gösterilmiştir.


```{r}
mainDF %>% group_by(`Departman:`) %>% mutate(`Departman:`=tolower(`Departman:`)) %>% summarise(frekans=n()) %>% arrange(-frekans) %>% filter(frekans>5)->freqDepartmanDF

mainDF %>%
  group_by(`Firma Sektörü:`) %>%
  mutate(`Firma Sektörü:` = tolower(`Firma Sektörü:`))  %>%
  select(`Firma Sektörü:`) %>%
  summarise(frekans = n()) %>%
  arrange(-frekans) %>%
  filter(frekans >5) ->freqSektorDF
```

```{r,results='asis'}
knitr::kable(freqDepartmanDF,
             caption = '**Departman ait frekans tablosu**')

knitr::kable(freqSektorDF,
             caption = '**Sektörlere ait frekans tablosu**')
```

```{r}
library(cowplot)
mainDF %>% 
  group_by(`Departman:`) %>%
  mutate(`Departman:`=tolower(`Departman:`)) %>%
  summarise(frekans=n()) %>% arrange(-frekans) %>%
  filter(frekans>5) %>%
  ggplot(.,aes(x=reorder(`Departman:`, frekans),y=frekans))+
 scale_y_continuous(breaks=seq(0,70,5))+
  geom_bar(stat = "identity",col='white',fill='steelblue')+
  labs(x='Deparmanlar')+
  theme_classic()+
  coord_flip()->departmanPlot

freqSektorDF %>%
  mutate(`Firma Sektörü:`=ifelse(is.na(`Firma Sektörü:`),'bilinmiyor',`Firma Sektörü:`)) %>% 
  ggplot(.,aes(x=reorder(`Firma Sektörü:`, frekans),y=frekans))+
  geom_bar(stat = "identity",col='white',fill='steelblue')+
  labs(x='Sektörler')+
  theme_classic()+
  scale_y_continuous(breaks=seq(0,70,5))+
  coord_flip()->sektorPlot

ggdraw() + 
  draw_label(
    "Departman ve sektörlere göre istihdam istatistikleri",
    fontface = 'bold',
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )->title






mainDF %>% 
  group_by(`Departman:`) %>%
  mutate(`Departman:`=tolower(`Departman:`)) %>%
  summarise(frekans=n()) %>% arrange(-frekans) %>%
  filter(frekans>5) %>%
  ggplot(.,aes(x=reorder(`Departman:`, frekans),y=frekans))+
 scale_y_continuous(breaks=seq(0,70,5))+
  geom_bar(stat = "identity",col='white',fill='steelblue')+
  labs(x='Deparmanlar')+
  theme_classic()+
  coord_flip()->departmanPlot

freqSektorDF %>%
  mutate(`Firma Sektörü:`=ifelse(is.na(`Firma Sektörü:`),'bilinmiyor',`Firma Sektörü:`)) %>% 
  ggplot(.,aes(x=reorder(`Firma Sektörü:`, frekans),y=frekans))+
  geom_bar(stat = "identity",col='white',fill='steelblue')+
  labs(x='Sektörler')+
  theme_classic()+
  scale_y_continuous(breaks=seq(0,70,5))+
  coord_flip()->sektorPlot

cowplot::ggdraw() + 
  draw_label(
    "Departman ve sektörlere göre istihdam istatistikleri",
    fontface = 'bold',
    x = 0,
    hjust = 0
  ) +
  theme(
    # add margin on the left of the drawing canvas,
    # so title is aligned with left edge of first plot
    plot.margin = margin(0, 0, 0, 7)
  )->title






plot_row<-cowplot::plot_grid(departmanPlot, sektorPlot)
cowplot::plot_grid(title,plot_row,nrow=2,
                   rel_heights = c(0.1, 1))

```


Bilgi teknolojileri/it, planlama ve finans alanı, en çok istihdam sağlayan departmanlardır .Sektörel anlamda ise bankacılık,perakende ve bilişim sektörü istatistik mezunlarına en çok istihdam sağlayan 3 sektördür. Bu sonuç, istatistik mezunlarının gün geçtikçe daha fazla bilgisayar ve yazılım teknolojileri ile iç içe çalıştğını göstermektedir.

Sektörel anlamda en çok istihdamın finans/bankacılık sektörü olduğu gözden kaçmamalıdır.

# iş ilanlarnın konumları

iş ilanlarının konumlarında istanbul'un avrupa ve anadolu yakaları 2 ayrı yer sayılırken kalan illerde herhangi bir değişiklik yapılmayacaktır.

Ayrıca bazı iş ilanlarında birden fazla konum olması, her bir bölgeyi ekstra sayılabileceği anlamına gelmektedir.Bu sebeple ilan sayısından daha fazla sayıda vilayet bulunmuş olmaktadır.


```{r}
#Harita grafiği excel'den eklenecektir.R üzerinde bu grafiğin özelleştirmesi problemlidir.
old1 <- "çğşıüöÇĞŞİÖÜ"
new1 <- "cgsiuocgsiou" 
```

```{r}
library(stringr)
 parantezsil<-function(x)gsub("\\s*\\([^\\)]+\\)","",as.character(x))


gsub("İstanbul(Avr.)", "istanbul", mainDF$city , fixed=TRUE)%>%
  gsub("İstanbul(Asya)","istanbul",.,fixed =TRUE ) %>% 
  gsub("İzmir","izmir",.,fixed =TRUE ) %>% 
  parantezsil() %>%
  gsub(" ","",.,fixed = TRUE) %>% 
  strsplit(",") %>% 
  lapply(., function(x)x[!duplicated(x)]) %>% 
  unlist() %>% 
  gsub(" ","",.) %>% 
  tolower() %>%
  table() %>%
  data.frame() %>% 
  rename(il=1,frekans='Freq') %>% 
  arrange(il)->ilFreqDF
 
ilFreqDF %>% kableExtra::kable()
   
```
#
<!-- # ```{r} -->
<!-- # TUR <- readRDS("TUR_adm1.rds") -->
<!-- # TUR$NAME_1 %>% sort() %>% tolower()->TR -->
<!-- # case_when( -->
<!-- #    TR %in% "nevsehir"~"nevşehir", -->
<!-- #    TR %in% "aydin"~"aydın", -->
<!-- #    TR %in% 'eskisehir' ~ 'eskişehir', -->
<!-- #    TR %in% 'k. maras' ~ 'kahramanmaraş', -->
<!-- #    TR %in% 'sanliurfa' ~ 'şanlıurfa', -->
<!-- #    TR %in% 'tekirdag' ~ 'tekirdağ', -->
<!-- #    !(TR%in%c('eskişehir','kahramanmaraş','şanlıurfa','tekirdağ','nevşehir','aydın'))~TR -->
<!-- #  -->
<!-- # )->TR -->
<!-- # TUR$NAME_1<-TR -->
<!-- # ``` -->
<!-- #  -->
<!-- # ```{r} -->
<!-- # fortify(TUR) -> TUR_for -->
<!-- # id_and_cities_ist <- data_frame(id = rownames(TUR@data), -->
<!-- #                                 'il' = TUR@data$NAME_1) %>% -->
<!-- #   left_join(ilFreqDF, by = "il")  -->
<!-- # final_ist_map <- left_join(TUR_for, id_and_cities_ist, by = "id") -->
<!-- # ``` -->
<!-- #  -->
<!-- # ```{r} -->
<!-- # library(mapproj) -->
<!-- # ggplot(final_ist_map) + -->
<!-- #   geom_polygon( aes(x = long, y = lat, group = group, fill = frekans), -->
<!-- #                 color = "grey") + -->
<!-- #   coord_map() + -->
<!-- #   theme_void() +  -->
<!-- #   labs(title = "2021 haziran ayı istatistik mezunlarına uygun iş ilanlarının konumları", -->
<!-- #        subtitle = paste0("Toplam çalışılabilir konum sayisi: ", sum(ilFreqDF$frekans)), -->
<!-- #        caption = "Veri Kaynağı: kariyer.net") + -->
<!-- #   scale_fill_distiller(palette = 'Reds', -->
<!-- #                        direction = 1, -->
<!-- #                          type = "seq", -->
<!-- #                        name = "illere göre ilan frekansı", -->
<!-- #                        limits = c(0,400), na.value = "white") + -->
<!-- #   theme(plot.title = element_text(hjust = 0.05), -->
<!-- #         plot.subtitle = element_text(hjust = 0.05)) -->


iş ilanlarının çoğunluğu incelendiğinde ağırlıklı olarak istanbulun iş havuzunun çok yüksek bir kısmını barındırdığı görülebilir. Finans,it,arge sektörlerinin çoğunlukla istanbulda yoğunlaşması bu sonucun nihai sebebidir.

```{r}
gsub("İstanbul(Avr.)", "istanbul.avrupa", mainDF$city , fixed=TRUE)%>%
  gsub("İstanbul(Asya)","istanbul.asya",.,fixed =TRUE ) %>% 
  gsub("İzmir","izmir",.,fixed =TRUE ) %>% 
  parantezsil() %>%
  gsub(" ","",.,fixed = TRUE) %>% 
  strsplit(",") %>% 
  lapply(., function(x)x[!duplicated(x)]) %>% 
  unlist() %>% 
  gsub(" ","",.) %>% 
  tolower() %>%
  table() %>%
  data.frame() %>% 
  rename(il=1,frekans='Freq') %>% 
  arrange(-frekans)->ilIstanbulFreqDF
ilIstanbulFreqDF[1:2,] %>% kableExtra::kable()
```

Bununla beraber Avrupa Yakasının iş imkanı sayısı, asya yakasına göre ~1,6 kat daha fazladır.Avrupa yakasında ikamet etmek iş bulma konusunda kolaylık  sağlama ihtimali kuvvetlidir.


# Askerlik şartları

Askerlik durum bilgisinde yapıldı,muaf,tecilli,yapılmadı şeklinde 4 farklı kategori bulunmakta.**Yapıldı** ve **muaf** kesinlikle askere gitmeyen bir kişiyi ifade ettiği için bu 2 grup yapıldı olarak kodlanmıştır. **tecilli** ve **yapılmadı** ise beraber değerlendirilmiştir.


```{r}
one_hot<-function(df,col){
  dummy_list<-list(NA)
  unique(as.vector(as.matrix(df[col])))->lvls
  
  
  for(i in 1:length(lvls)){
    ifelse(as.vector(df[col]== lvls[i]),1,NA)->dummy_list[[i]]
    add_column(df, !!(lvls[i]) := dummy_list[[i]])->df
  }
  return(df)
}
```

```{r}
mainDF$`Askerlik Durumu:` %>% unique()
mainDF %>% select(`Askerlik Durumu:`) %>%
  mutate(`Askerlik Durumu:`=case_when(
  grepl('Yapılmadı|Tecilli',mainDF$`Askerlik Durumu:`)~'yapıldı-muaf',
  grepl('Muaf|Yapıldı',mainDF$`Askerlik Durumu:`)~'tecilli-yapılmadı',
  is.na(mainDF$`Askerlik Durumu:`)~NA_character_)) %>%
  group_by(`Askerlik Durumu:`) %>% 
  summarise(`freq`=n()) ->askerlikfrekansdf
  askerlikfrekansdf %>% kableExtra::kable()
askerlikfrekansdf[which(is.na(askerlikfrekansdf$`Askerlik Durumu:`)),]$freq->askerNailanSayisi
```



Veride askerlik bilgisine dair büyük bir kısımda herhangi bir bilgi girişi yapılmamıştır.`askerNailanSayisi` sayıda ilan hakkında bilgi yoktur.

Yinede yeterli sayıda ilan askerlikle alakalı bilgi vermektedir.
Bilinenin aksine ilanların büyük bir kısmında işverenlerin askerliğin makul bir tecil süresini kabul edilebilir bulduğu görülmektedir.


# Tecrübe

Pozisyonlar için gerekli olan tecrübe seviyesi aşağıda belirtilmiştir.

```{r}
mainDF %>% select(`Tecrübe:`,pozisyon) %>% mutate(min=case_when(
  grepl("En az",mainDF$`Tecrübe:`)~str_extract(mainDF$`Tecrübe:`,'\\d+'),
  grepl("^\\d+",mainDF$`Tecrübe:`)~str_extract(mainDF$`Tecrübe:`,'^\\d+'),
  grepl('tecrübesiz|Tecrübesiz',mainDF$`Tecrübe:`)~"0"),
  max=case_when(
    grepl("En az",mainDF$`Tecrübe:`)~NA_character_,
    grepl('En çok',mainDF$`Tecrübe:`)~str_extract(mainDF$`Tecrübe:`,'\\d+'),
  grepl("^\\d+",mainDF$`Tecrübe:`)~(str_extract_all(mainDF$`Tecrübe:`,'\\d+') %>% 
    lapply(.,function(x){
  ifelse(length(x)>1,x[2],NA)}
) %>% unlist())
  )) ->tecrubeMinMaxDF
```

```{r}
tecrubeMinMaxDF$min %>% 
  as.numeric() %>%
  sort() %>% 
  table(min=.) %>%
  data.frame() %>%
  mutate(min=as.integer(min),
         cumulative_freq=cumsum(Freq))->CumulativeMinExpDf


ggplot(data=CumulativeMinExpDf, aes(x=min, y=cumulative_freq)) +
    geom_point()+
  theme_minimal()+
  geom_label(aes(x = min, y = cumulative_freq+30, label =paste("K:",cumulative_freq,"\nG:",Freq)), fill ="#66A61E",alpha = 0.6,size=3)+
  geom_label(label =
                 "K:kümülatif deger\nG:gerçek deger",x=11,y=120)+
  scale_x_discrete(limits=factor(CumulativeMinExpDf$min))+
  geom_line(color="#E69F00",size=1.2)+
  labs(y ="Kümülatif Toplam",
       x ="Minimum tecrübe süresi(Yıl)",
       caption  = "Veri kaynağı:kariyer.net\nEksik ilan sayısı:7\nFatih Ekici")

  

```

En çok aranan seviyenin mid level pozisyonlar olduğunu görülmüştür. `r tecrubeMinMaxDF %>% filter(min<5) %>% nrow` kişi yani 5 yıldan fazla tecrübeye sahip birisi ilanların \~%80'nine başvuruda bulunabilmektedir.

Maksimum tecrübe istatistiği yeterli veri olmaması sebebiyle analize dahil edilmemiştir.

## Yönetici pozisyonlar

İçerisinde yönetici,müdür,manager kelimelerinin geçtiği ilanlardan yönetici sınıfı için gerekli minimum çalışma süresinin grafiği aşağıda verilmiştir.

```{r}
tecrubeMinMaxDF[grepl('müdür|yönetici|manager',tolower(tecrubeMinMaxDF$pozisyon)),]$min %>% 
  as.numeric() %>%
  sort() %>% .[.>1] %>% 
  table(min=.) %>%
  data.frame() %>%
  mutate(min=as.integer(min),
         cumulative_freq=cumsum(Freq))->CumulativeMinExpManagerDf

ggplot(data=CumulativeMinExpManagerDf, aes(x=min, y=cumulative_freq)) +
    geom_point()+
  theme_minimal()+
  geom_label(aes(x = min, y = cumulative_freq+5, label =paste("K:",cumulative_freq,"\nG:",Freq)), fill ="#66A61E",alpha = 0.6,size=3)+
  geom_label(label =
                 "K:kümülatif deger\nG:gerçek deger",x=9,y=10)+
  scale_x_discrete(limits=factor(CumulativeMinExpDf$min))+
  geom_line(color="#E69F00",size=1.2)+
  labs(y ="Kümülatif Toplam",
       x ="Minimum tecrübe süresi(Yıl)",
       caption  = "Veri kaynağı:kariyer.net\nFatih Ekici")

```

İçerisinde **yönetici**,**müdür**,**manager** kelimelerinin geçtiği ilananlarının minimum tecrübe süresini incelendiğinde 5.yıldan itibaren ilan sayısında hatrı sayılır artış görülmüştür.
5 yıllık tecrübe yönetici pozisyonu sayısındaki ivme dikkate alındığında Türkiyedeki yönetici pozisyonları aranan bir özellik olduğu görülmüştür.
# ilanların genelleme yapılabilmesi adına kümelenmesi
<-Harun yazacak daha a..


# ilan içeriklerinin analiz edilmesi

Bu aşamada ilan içeriklerindeki hard skill'lerin bulunması ve benzer iş ilanlarının kümelenerek bu ilanlara ait becerilerde ne tür farklılıklar/benzerlikler olduğu analiz edilecektir.

## Metinlerin temizlenmesi

```{r}
cluster_ilan_main <- read_csv("cluster_ilan_main.csv")
cluster_ilan_main %>% distinct()  %>% filter(urls%in% mainDF$urls)->cluster_ilan_main

cluster_ilan_main %>% group_by(cluster) %>% summarise(Freq=n())
```


